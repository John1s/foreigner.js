/*! foreigner.js - v0.0.1 - 2014-11-26
 * http://github.com/mirego/foreigner.js
 *
 * Copyright (c) 2013-2014 Mirego <http://mirego.com>;
 * Licensed under the New BSD license */

!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("foreigner",[],b):a.foreigner=b()}(this,function(){var foreigner,a="\\s*",b="[a-z0-9_\\$]+",c="\\{"+a+"("+b+")"+a+","+a+"(select|plural)"+a+","+a+"((?:\\w+"+a+"\\{[^\\}]+\\}"+a+")+)\\}",d="\\{"+a+"("+b+")"+a+"\\}",e=new RegExp("(?:"+c+")|(?:"+d+")","gi"),f=new RegExp("(\\w+)"+a+"\\{([^\\}]+)\\}","gi"),g={0:"zero",1:"one",2:"two"},h=function(a){var b=a.indexOf(".")>=0?i(a):j(a);return b?k(b):null},i=function(a){var b=a.split(".");value=foreigner.translations[foreigner.locale];for(var c=0;c<b.length&&value;){var d=b[c];value="object"==typeof value&&d in value?value[d]:null,c++}return value},j=function(a){return foreigner.translations[foreigner.locale][a]},k=function(a){for(;a&&"!"==a.charAt(0);)a=h(a.slice(1));return a},l=function(a){for(var b,c=[];null!==(b=e.exec(a));){var d={toReplace:b[0],action:"",key:"",choices:{}};if(b[4])d.action="interpolation",d.key=b[4];else{d.key=b[1],d.action=b[2];for(var g;null!==(g=f.exec(b[3]));)d.choices[g[1]]=g[2]}c.push(d)}return f.lastIndex=0,e.lastIndex=0,c},m=function(a,b,c){for(var d=0,e=b.length;e>d;d++){var f,h=b[d],i=null==c[h.key]?"":c[h.key];switch(h.action){case"interpolation":f=i;break;case"plural":f=h.choices[i]||h.choices[g[i]]||h.choices.other,f=f.replace("#",i);break;case"select":f=h.choices[i]||h.choices.other}a=a.replace(h.toReplace,f)}return a};return foreigner={locale:"",translations:{},t:function(a,b){if(!foreigner.locale)throw new Error("[foreigner] You tried to lookup a translation before setting a locale.");var c=h(a);if(!c)return null;if("object"!=typeof b)return c;var d=l(c);return m(c,d,b)}}});