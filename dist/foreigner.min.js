/*! foreigner.js - v0.0.1 - 2013-08-15
 * http://github.com/mirego/foreigner.js
 *
 * * Copyright (c) 2013 Mirego <http://mirego.com>;
 * Licensed under the New BSD license */

!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("foreigner",[],b):a.foreigner=b()}(this,function(){var foreigner,a=function(a){var b=null;if(-1!=a.indexOf(".")){var c=a.split(".");b=foreigner.translations[foreigner.locale];for(var d=0,e=c.length;e>d;d++){var f=c[d];if(!("object"==typeof b&&f in b)){b=null;break}b=b[f]}}else b=foreigner.translations[foreigner.locale][a];return b?b:null},b=function(){var a=/(?:\{([a-z0-9_\$]+)\s*,\s*(select|plural)\s*,\s*((?:\w+\s*\{[^\}]+\}(?:\s*)?)+)\})|(?:\{([a-z0-9_\$]+)\})/gi,b=/(\w+)(?:\s*)?\{([^\}]+)\}/gi;return function(c){for(var d,e=[];null!==(d=a.exec(c));){var f;if(d[4])f={toReplace:d[0],action:"interpolation",key:d[4]},e.push(f);else{f={toReplace:d[0],key:d[1],action:d[2],choices:{}};for(var g;null!==(g=b.exec(d[3]));)f.choices[g[1]]=g[2];b.lastIndex=0,e.push(f)}b.lastIndex=0}return a.lastIndex=0,e}}(),c=function(a,b){return function(c){for(var d=0,e=b.length;e>d;d++){var f,g=b[d];switch(null==c[g.key]&&(c[g.key]=""),g.action){case"select":f=g.choices[c[g.key]]||g.choices.other;break;case"plural":var h={0:"zero",1:"one",2:"two"};f=g.choices[c[g.key]]||g.choices[h[c[g.key]]]||g.choices.other,f=f.replace("#",c[g.key]);break;case"interpolation":f=c[g.key]}a=a.replace(g.toReplace,f)}return a}};return foreigner={locale:"",translations:{},t:function(d,e){if("object"!=typeof e&&(e={}),!foreigner.locale)throw new Error("[foreigner] You tried to lookup a translation before setting a locale.");var f=a(d);if(!f)return null;for(;"string"==typeof f&&"!"==f.charAt(0);)f=a(f.slice(1));if(0===Object.keys(e).length)return f;var g=b(f),h=c(f,g);return h(e)}}});